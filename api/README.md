# ABC Verification API Service

REST API for verifying ABC receipt hashes from Foundry pipeline.

## Overview

This API service provides endpoints to verify that ABC receipt hashes generated by Foundry pipelines match what ABC would generate for the same data.

## Setup

1. **Install dependencies:**
   ```bash
   pip install -r api/requirements.txt
   ```

2. **Configure environment variables:**
   Make sure your `.env` file has:
   ```
   FOUNDRY_CLIENT_ID=bb161f568da2d398f450213c661b1a67
   FOUNDRY_CLIENT_SECRET=your_client_secret
   FOUNDRY_URL=https://ghsystems.usw-16.palantirfoundry.com
   ```

3. **Run the service:**
   ```bash
   # Using startup script (recommended)
   ./scripts/start_api_simple.sh
   
   # Or using uvicorn directly
   uvicorn api.abc_verification_service:app --reload --port 8000
   
   # Or using Python directly
   python api/abc_verification_service.py
   ```

4. **Access the API:**
   - API Docs: http://localhost:8000/docs
   - Health check: http://localhost:8000/health

## API Endpoints

### `GET /`
Root endpoint - returns API information.

### `POST /verify`
Verify a single ABC receipt hash.

**Request:**
```json
{
    "block_data": {
        "block_height": 825000,
        "block_hash": "94f84c7be087799b54c3e4adce1f9012a7e3c8d4b6f5a2e1c9d8b7a6f5e4d3c2",
        "timestamp": 1735689600,
        "tx_count": 2453,
        "transactions": "[{\"txid\":\"abc123\",\"value\":0.5}]"
    },
    "abc_receipt_hash": "472dc3097fb9f4a1228e6cb5a0202b11a9fe3751dffa1065b781eca848ddb94b"
}
```

**Response:**
```json
{
    "success": true,
    "result": {
        "verified": true,
        "block_height": 825000,
        "foundry_hash": "472dc3097fb9f4a1228e6cb5a0202b11a9fe3751dffa1065b781eca848ddb94b",
        "computed_hash": "472dc3097fb9f4a1228e6cb5a0202b11a9fe3751dffa1065b781eca848ddb94b",
        "timestamp": "2026-01-01T20:00:00.000000"
    },
    "message": "Verification complete"
}
```

### `POST /verify/batch`
Verify multiple ABC receipts in batch.

**Request:**
```json
{
    "requests": [
        {
            "block_data": {...},
            "abc_receipt_hash": "..."
        },
        {
            "block_data": {...},
            "abc_receipt_hash": "..."
        }
    ]
}
```

**Response:**
```json
{
    "total": 2,
    "verified": 2,
    "failed": 0,
    "results": [...]
}
```

### `GET /health`
Health check endpoint.

### `GET /docs`
Interactive API documentation (Swagger UI).

## API Documentation

Once the service is running, visit:
- **Swagger UI:** http://localhost:8000/docs
- **ReDoc:** http://localhost:8000/redoc

## Testing

### Using curl:

```bash
# Single verification
curl -X POST "http://localhost:8000/verify" \
  -H "Content-Type: application/json" \
  -d '{
    "block_data": {
      "block_height": 825000,
      "block_hash": "94f84c7be087799b54c3e4adce1f9012a7e3c8d4b6f5a2e1c9d8b7a6f5e4d3c2",
      "timestamp": 1735689600,
      "tx_count": 2453,
      "transactions": "[{\"txid\":\"abc123\",\"value\":0.5}]"
    },
    "abc_receipt_hash": "472dc3097fb9f4a1228e6cb5a0202b11a9fe3751dffa1065b781eca848ddb94b"
  }'

# Health check
curl http://localhost:8000/health
```

### Using Python:

```python
import requests

response = requests.post(
    "http://localhost:8000/verify",
    json={
        "block_data": {
            "block_height": 825000,
            "block_hash": "94f84c7be087799b54c3e4adce1f9012a7e3c8d4b6f5a2e1c9d8b7a6f5e4d3c2",
            "timestamp": 1735689600,
            "tx_count": 2453,
            "transactions": '[{"txid":"abc123","value":0.5}]'
        },
        "abc_receipt_hash": "472dc3097fb9f4a1228e6cb5a0202b11a9fe3751dffa1065b781eca848ddb94b"
    }
)

print(response.json())
```

## Deployment

For production deployment, consider:
- Using a production ASGI server (Gunicorn with Uvicorn workers)
- Setting up proper CORS policies
- Adding authentication/authorization
- Using environment-specific configuration
- Setting up monitoring and logging

## License

Copyright (c) 2026 GH Systems. All rights reserved.

